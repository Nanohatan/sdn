<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title><%- class_name %>講義一覧</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://192.168.98.25:8080/static/css/navibar.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<style>
    #search_box{
        text-align: center;
    }

    input {
        width: 50%;
        padding: 10px 20px;
        margin: 10px 0;
        box-sizing: border-box;
        font-size: 15px;
    }
    button {
        font-size: 30px;
    }
</style>
<body>
    <!-- navigation bar -->
    <div class="navbar">
        <a href="/auth/login" >時間割</a>
        <a href="/search/">授業検索</a>
        <!-- 
        <% if (role) { %>
            <a href="/upload/?class_name=<%- class_name %>">アップロード</a>
        <% } %> 
        　-->
    </div>

    <!-- input for serching -->
    <div id="search_box">
        <h1><%- class_name %></h1>
        <form action="">
            <input type="text" id="video_search" name="video_search" >
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
    </div>
    <button type="button">時間割に追加</button>

    <!-- class list-->
    <div class="class-list">
        <div class="class-video">
            <h2>第N回目</h2><p>ここに動画タイトル、url</p>
        </div>

        <style>
        .class-list{
            border-style: dashed;
            border-color: black;
        }
        .class-video{
            margin: 10px;
            height: 20%;
            border-style: dashed;
            border-color: green;
            background-color: #E6F2FF;
        }
        </style>
    </div>

    <script>
        var classes = <%-[ JSON.stringify(class_name)] %>;
        var lectures = <%- JSON.stringify(jd) %>;
        console.log(classes);
        create_list(classes);
        
        
        //検索ボタンがクリックされたら文字列を含む講義名のみ表示する．
        $('#button').on('click', function(){
            $('.class-list').empty();  
            str = document.getElementById("video_search").value;
            jobj = [];
            lectures.forEach(function(lec){
                console.log(lec);
                console.log(str);
                if ( lec.lecture_name.includes(str) || lec.lecture_time.toString().includes(str)) {
                    jobj.push(lec);
                };
            });
            create_list(jobj);
        });
        
        function create_list(jobj){
            jobj.forEach(function(jd){
                let currentDiv=document.getElementsByClassName("class-list")[0];
                let newDiv=document.createElement('div');
                let newa=document.createElement('a');
                let newh2=document.createElement('h2');
                let newPara=document.createElement('p');
                newDiv.className ="class-video";
        
                currentDiv.appendChild(newDiv);
                newa.href="/video/"+jd.movie_id
                newDiv.appendChild(newa);
                newh2.textContent="第"+jd.lecture_time+"回目";
                newPara.textContent=jd.lecture_name;
                newa.appendChild(newh2);
                newa.appendChild(newPara);
            });
        }
    </script>    
</body>
</html>

